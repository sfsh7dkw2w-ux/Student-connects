<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Student Portal</title>

<style>
  body{
    margin:0;
    font-family:-apple-system,BlinkMacSystemFont,Arial,sans-serif;
    background:#eef2f5;
  }
  .topbar{
    background:#2d3e50;
    color:#fff;
    padding:15px;
    text-align:center;
    font-weight:bold;
    font-size:18px;
    cursor:pointer;
    user-select:none;
    -webkit-user-select:none;
  }
  .subbar{
    background:#4f6d8c;
    color:#fff;
    padding:12px;
    text-align:center;
  }
  .container{ padding:15px; }

  .card{
    background:#fff;
    border-radius:12px;
    padding:15px;
    margin-bottom:12px;
    box-shadow:0 2px 6px rgba(0,0,0,0.1);
  }
  .title{ font-weight:bold; }
  .teacher{ color:#4f6d8c; margin-top:3px; }

  .assignment{
    margin-top:6px;
    padding:8px 10px;
    background:#f5f7fa;
    border-radius:8px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
  }
  .deleteX{
    cursor:pointer;
    color:#c4001a;
    font-weight:bold;
    padding:4px 8px;
    border-radius:8px;
  }
  .deleteX:hover{ background:#fdecef; }

  .login{
    display:flex;
    justify-content:center;
    align-items:center;
    height:80vh;
  }
  .login button{
    padding:14px 24px;
    font-size:16px;
    border-radius:10px;
    border:none;
    background:#2d3e50;
    color:#fff;
    cursor:pointer;
  }
  .login button:hover{ opacity:0.92; }

  .hidden{ display:none !important; }

  /* Modal */
  .modal{
    position:fixed;
    top:0; left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.45);
    display:flex;
    justify-content:center;
    align-items:center;
    padding:16px;
    z-index:999;
  }
  .modal-content{
    width:100%;
    max-width:440px;
    background:#fff;
    border-radius:14px;
    box-shadow:0 10px 30px rgba(0,0,0,0.25);
    padding:18px;
  }
  .modal-title{
    font-weight:bold;
    font-size:18px;
    margin-bottom:10px;
  }
  .modal-content input,
  .modal-content select{
    width:100%;
    box-sizing:border-box;
    padding:12px;
    margin-top:10px;
    border-radius:10px;
    border:1px solid #cfd8e3;
    font-size:15px;
    outline:none;
  }
  .modal-row{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-top:12px;
  }
  .modal-row button{
    flex:1 1 140px;
    padding:12px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-weight:bold;
  }
  .saveBtn{ background:#2d3e50; color:#fff; }
  .closeBtn{ background:#e7ecf2; color:#1f2a33; }
  .errorText{
    margin-top:10px;
    color:#c4001a;
    font-weight:bold;
    font-size:13px;
  }
  .smallNote{
    margin-top:10px;
    font-size:12px;
    opacity:0.75;
    line-height:1.35;
  }
</style>
</head>

<body>
  <div class="topbar" id="header">Dearborn Public Schools</div>
  <div class="subbar">Assignments</div>

  <div class="container">
    <!-- Login screen -->
    <div id="login" class="login">
      <button id="loginBtn">Sign In</button>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="hidden"></div>
  </div>

  <!-- Admin Modal (hidden on load) -->
  <div id="adminModal" class="modal hidden" hidden style="display:none;">
    <div class="modal-content" id="adminModalBox">
      <div class="modal-title">Admin</div>

      <!-- Step 1: Password -->
      <div id="adminStepPass">
        <input id="adminPassInput" type="password" placeholder="Enter admin password" inputmode="numeric" />
        <div class="modal-row">
          <button class="saveBtn" id="adminUnlockBtn">Unlock</button>
          <button class="closeBtn" id="adminCloseBtn1">Close</button>
        </div>
        <div id="adminPassErr" class="errorText hidden">Incorrect password.</div>
      </div>

      <!-- Step 2: Form -->
      <div id="adminStepForm" class="hidden">
        <select id="classSelect"></select>
        <input id="assignName" type="text" placeholder="Assignment name (ex: Homework 1)" />
        <div class="modal-row">
          <button class="saveBtn" id="saveAssign">Save</button>
          <button class="closeBtn" id="adminCloseBtn2">Close</button>
        </div>
        <div class="smallNote">
          Delete (✕) is only available while admin is unlocked.
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  // ===== CONFIG =====
  var ADMIN_PASSWORD = "20126693";
  var isAdminUnlocked = false; // delete is only enabled when true

  var classes = [
    {id:1,name:"Chemistry S2",teacher:"Bazzi-Hijazi, R"},
    {id:2,name:"Arabic 2 S2",teacher:"Raishouni, O"},
    {id:3,name:"PE/Health 9 Boys",teacher:"Hamade, M"},
    {id:4,name:"Language Arts 2",teacher:"Marwani, H"},
    {id:5,name:"AP Human Geography",teacher:"Jedele, S"},
    {id:6,name:"Algebra 2 S2",teacher:"AlHadrawi, M"}
  ];

  // ===== ELEMENTS =====
  var login = document.getElementById("login");
  var loginBtn = document.getElementById("loginBtn");
  var dashboard = document.getElementById("dashboard");
  var header = document.getElementById("header");

  var adminModal = document.getElementById("adminModal");
  var adminModalBox = document.getElementById("adminModalBox");

  var adminStepPass = document.getElementById("adminStepPass");
  var adminStepForm = document.getElementById("adminStepForm");

  var adminPassInput = document.getElementById("adminPassInput");
  var adminPassErr = document.getElementById("adminPassErr");
  var adminUnlockBtn = document.getElementById("adminUnlockBtn");
  var adminCloseBtn1 = document.getElementById("adminCloseBtn1");
  var adminCloseBtn2 = document.getElementById("adminCloseBtn2");

  var classSelect = document.getElementById("classSelect");
  var assignName = document.getElementById("assignName");
  var saveAssign = document.getElementById("saveAssign");

  // Always start with admin hidden (extra safety)
  forceHideAdmin();

  function forceHideAdmin(){
    adminModal.classList.add("hidden");
    adminModal.setAttribute("hidden","hidden");
    adminModal.style.display = "none";
  }
  function showAdmin(){
    adminModal.classList.remove("hidden");
    adminModal.removeAttribute("hidden");
    adminModal.style.display = "flex";
  }
  function closeAdmin(){
    // leaving admin mode turns off delete
    isAdminUnlocked = false;
    forceHideAdmin();
    // re-render so X disappears immediately
    render();
  }

  // ===== LOGIN =====
  loginBtn.addEventListener("click", function(){
    login.classList.add("hidden");
    dashboard.classList.remove("hidden");
    render();
  });

  // ===== RENDER DASHBOARD =====
  function render(){
    dashboard.innerHTML = "";

    for(var i=0;i<classes.length;i++){
      var c = classes[i];
      var assignments = JSON.parse(localStorage.getItem("assign_"+c.id) || "[]");

      var card = document.createElement("div");
      card.className = "card";
      card.innerHTML =
        "<div class='title'>" + escapeHtml(c.name) + "</div>" +
        "<div class='teacher'>" + escapeHtml(c.teacher) + "</div>" +
        "<div id='assign_"+c.id+"'></div>";

      dashboard.appendChild(card);

      var container = document.getElementById("assign_"+c.id);

      if(assignments.length === 0){
        var empty = document.createElement("div");
        empty.style.opacity = "0.7";
        empty.style.marginTop = "8px";
        empty.textContent = "No assignments yet.";
        container.appendChild(empty);
      } else {
        for(var j=0;j<assignments.length;j++){
          addAssignmentRow(container, c.id, assignments[j], j);
        }
      }
    }
  }

  function addAssignmentRow(container, classId, name, index){
    var div = document.createElement("div");
    div.className = "assignment";

    var left = document.createElement("span");
    left.textContent = name;
    div.appendChild(left);

    // Only show delete button in admin mode
    if(isAdminUnlocked){
      var right = document.createElement("span");
      right.className = "deleteX";
      right.textContent = "✕";
      right.setAttribute("data-class", String(classId));
      right.setAttribute("data-index", String(index));
      div.appendChild(right);
    }

    container.appendChild(div);
  }

  function escapeHtml(s){
    s = String(s);
    return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")
            .replace(/"/g,"&quot;").replace(/'/g,"&#39;");
  }

  // ===== DELETE (only if admin unlocked) =====
  document.addEventListener("click", function(e){
    var t = e.target;
    if(!t || !t.getAttribute) return;

    // Only allow delete in admin mode
    if(!isAdminUnlocked) return;

    var classId = t.getAttribute("data-class");
    var index = t.getAttribute("data-index");
    if(!classId) return;

    var arr = JSON.parse(localStorage.getItem("assign_"+classId) || "[]");
    arr.splice(Number(index), 1);
    localStorage.setItem("assign_"+classId, JSON.stringify(arr));
    render();
  });

  // ===== ADMIN: only opens after 5 taps on header =====
  // iOS Safari: touchend can create an extra "ghost click" — we prevent double counting.
  var tapCount = 0;
  var tapTimer = null;
  var lastTouchTime = 0;

  function registerTap(){
    tapCount++;
    if(tapTimer) clearTimeout(tapTimer);
    tapTimer = setTimeout(function(){ tapCount = 0; }, 2000);

    if(tapCount >= 5){
      tapCount = 0;
      openAdmin();
    }
  }

  header.addEventListener("touchend", function(e){
    e.preventDefault();
    lastTouchTime = Date.now();
    registerTap();
  }, {passive:false});

  header.addEventListener("click", function(){
    if(Date.now() - lastTouchTime < 600) return; // ignore ghost click
    registerTap();
  });

  function openAdmin(){
    // reset modal steps
    adminPassInput.value = "";
    assignName.value = "";
    adminPassErr.classList.add("hidden");

    adminStepPass.classList.remove("hidden");
    adminStepForm.classList.add("hidden");

    showAdmin();
    setTimeout(function(){ adminPassInput.focus(); }, 50);
  }

  // ===== Admin close behavior =====
  adminCloseBtn1.addEventListener("click", closeAdmin);
  adminCloseBtn2.addEventListener("click", closeAdmin);

  adminModal.addEventListener("click", function(e){
    if(e.target === adminModal) closeAdmin();
  });
  adminModalBox.addEventListener("click", function(e){
    e.stopPropagation();
  });

  // ===== Admin unlock (password) =====
  adminUnlockBtn.addEventListener("click", function(){
    var pass = (adminPassInput.value || "").replace(/\s+/g,"");
    if(pass !== ADMIN_PASSWORD){
      adminPassErr.classList.remove("hidden");
      return;
    }

    // Unlock admin mode (enables delete and shows X)
    isAdminUnlocked = true;

    adminPassErr.classList.add("hidden");

    // Populate class list
    classSelect.innerHTML = "";
    for(var i=0;i<classes.length;i++){
      var opt = document.createElement("option");
      opt.value = String(classes[i].id);
      opt.textContent = classes[i].id + " - " + classes[i].name;
      classSelect.appendChild(opt);
    }

    adminStepPass.classList.add("hidden");
    adminStepForm.classList.remove("hidden");

    // re-render so X buttons appear immediately
    render();

    setTimeout(function(){ assignName.focus(); }, 50);
  });

  // ===== Save assignment =====
  saveAssign.addEventListener("click", function(){
    var classId = classSelect.value;
    var name = (assignName.value || "").trim();
    if(!name) return;

    var arr = JSON.parse(localStorage.getItem("assign_"+classId) || "[]");
    arr.push(name);
    localStorage.setItem("assign_"+classId, JSON.stringify(arr));

    assignName.value = "";

    // Keep admin unlocked while modal is open, but close modal after save
    // (Close resets admin to locked, per your preference)
    closeAdmin();
    render();
  });

})();
</script>
</body>
</html>
