<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Portal</title>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,Arial,sans-serif;
  background:#eef2f5;
}
.topbar{
  background:#2d3e50;
  color:white;
  padding:15px;
  text-align:center;
  font-weight:bold;
  font-size:18px;
  cursor:pointer;
  user-select:none;
}
.subbar{
  background:#4f6d8c;
  color:white;
  padding:12px;
  text-align:center;
}
.container{ padding:15px; }

.card{
  background:white;
  border-radius:12px;
  padding:15px;
  margin-bottom:12px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
}
.title{ font-weight:bold; }
.teacher{ color:#4f6d8c; margin-top:3px; }
.grade{ margin-top:8px; font-weight:bold; }

.hidden{ display:none; }

.login{
  display:flex;
  justify-content:center;
  align-items:center;
  height:80vh;
}
</style>
</head>

<body>

<div class="topbar" id="header">Dearborn Public Schools</div>
<div class="subbar" id="subbar">Assignments</div>

<div class="container">
  <div id="login" class="login">
    <div>
      <div id="g_id_onload"></div>
      <div class="g_id_signin"
        data-type="standard"
        data-size="large"
        data-theme="outline"
        data-text="signin_with"
        data-shape="rectangular">
      </div>
    </div>
  </div>

  <div id="dashboard" class="hidden"></div>
</div>

<script src="https://accounts.google.com/gsi/client" async defer></script>

<script>
(function(){

/* ============================
   CONFIG
============================ */

var GOOGLE_CLIENT_ID = "PASTE_YOUR_REAL_CLIENT_ID_HERE";
var ADMIN_EMAIL = "youradmin@email.com";

/* ============================
   DATA
============================ */

var classes = [
 {id:1,name:"Chemistry S2",teacher:"Bazzi-Hijazi, R"},
 {id:2,name:"Arabic 2 S2",teacher:"Raishouni, O"},
 {id:3,name:"PE/Health 9 Boys",teacher:"Hamade, M"},
 {id:4,name:"Language Arts 2",teacher:"Marwani, H"},
 {id:5,name:"AP Human Geography",teacher:"Jedele, S"},
 {id:6,name:"Algebra 2 S2",teacher:"AlHadrawi, M"}
];

var dashboard = document.getElementById("dashboard");
var login = document.getElementById("login");
var header = document.getElementById("header");
var subbar = document.getElementById("subbar");

var currentUserEmail = null;

/* ============================
   GOOGLE LOGIN
============================ */

window.handleCredentialResponse = function(response){
  var jwt = response.credential;
  var payload = jwt.split(".")[1];
  payload = payload.replace(/-/g,'+').replace(/_/g,'/');
  while(payload.length % 4) payload += '=';
  var data = JSON.parse(decodeURIComponent(escape(atob(payload))));
  
  currentUserEmail = data.email;

  login.classList.add("hidden");
  dashboard.classList.remove("hidden");
  subbar.innerHTML = "Assignments â€” " + data.name;

  render();
};

document.getElementById("g_id_onload")
  .setAttribute("data-client_id", GOOGLE_CLIENT_ID);
document.getElementById("g_id_onload")
  .setAttribute("data-callback","handleCredentialResponse");

/* ============================
   RENDER
============================ */

function render(){
  dashboard.innerHTML = "";

  for(var i=0;i<classes.length;i++){
    var c = classes[i];
    var assignments = JSON.parse(localStorage.getItem("assign_"+c.id) || "[]");

    var percent = compute(assignments);
    var letter = grade(percent);

    var card = document.createElement("div");
    card.className = "card";
    card.innerHTML =
      "<div class='title'>" + c.name + "</div>" +
      "<div class='teacher'>" + c.teacher + "</div>" +
      "<div class='grade'>Grade: " + letter + 
      " (" + (percent ? percent.toFixed(1)+"%" : "--") + ")</div>";

    dashboard.appendChild(card);
  }
}

function compute(list){
  if(!list.length) return null;
  var total=0, weight=0;
  for(var i=0;i<list.length;i++){
    total += (list[i].earned/list[i].possible)*list[i].weight;
    weight += list[i].weight;
  }
  return (total/weight)*100;
}

function grade(p){
  if(p==null) return "--";
  if(p>=93) return "A";
  if(p>=90) return "A-";
  if(p>=87) return "B+";
  if(p>=83) return "B";
  if(p>=80) return "B-";
  if(p>=70) return "C";
  if(p>=60) return "D";
  return "F";
}

/* ============================
   ADMIN (Hidden + Email Restricted)
============================ */

var tapCount=0;
var timer=null;

header.addEventListener("click",function(){
  tapCount++;
  clearTimeout(timer);
  timer=setTimeout(function(){tapCount=0;},1000);

  if(tapCount===5){
    tapCount=0;
    if(currentUserEmail===ADMIN_EMAIL){
      openAdmin();
    }
  }
});

function openAdmin(){
  var classId = prompt("Class ID?");
  if(!classId) return;

  var name = prompt("Assignment name?");
  if(!name) return;

  var earned = parseFloat(prompt("Points earned?"));
  var possible = parseFloat(prompt("Points possible?"));
  var weight = parseFloat(prompt("Weight? (1 default)")) || 1;

  var arr = JSON.parse(localStorage.getItem("assign_"+classId) || "[]");
  arr.push({earned:earned,possible:possible,weight:weight});
  localStorage.setItem("assign_"+classId,JSON.stringify(arr));

  render();
}

})();
</script>
</body>
</html>
